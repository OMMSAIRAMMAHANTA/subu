<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstraBill - Professional Electricity Bill Predictor</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts: Plus Jakarta Sans for UI, Outfit for display numbers -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6366f1',    // Indigo 500
                        primaryHover: '#4f46e5', // Indigo 600
                        secondary: '#14b8a6',  // Teal 500
                        dark: '#0b1120',       // Deep professional dark background
                        card: 'rgba(15, 23, 42, 0.6)'
                    },
                    animation: {
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'pulse-glow': 'pulseGlow 3s ease-in-out infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        pulseGlow: {
                            '0%, 100%': { opacity: '0.4', transform: 'scale(1)' },
                            '50%': { opacity: '0.8', transform: 'scale(1.05)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0b1120;
            background-image: 
                linear-gradient(to bottom, rgba(11, 17, 32, 0.6), rgba(11, 17, 32, 0.85)),
                url('https://image2url.com/r2/default/images/1771915675383-ff0d698e-78a8-47ad-809a-48348f10aa6a.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #f8fafc;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .tab-active {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #818cf8;
            box-shadow: inset 0 0 12px rgba(99, 102, 241, 0.1);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
            margin-top: -7px;
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.6);
            transition: transform 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #1e293b;
            border-radius: 2px;
        }
        
        /* Animation Staggers */
        .stagger-1 { animation-delay: 100ms; }
        .stagger-2 { animation-delay: 250ms; }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans antialiased selection:bg-primary selection:text-white overflow-x-hidden">

    <!-- Navbar -->
    <nav class="glass-panel sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-white/5 animate-fade-in">
        <div class="flex items-center gap-3 cursor-pointer group">
            <div class="relative flex items-center justify-center h-12 w-12 transition-transform duration-500 group-hover:scale-105">
                <img src="https://image2url.com/r2/default/images/1771915610959-238c3438-12b8-4c4e-81af-9add6c768516.png" alt="AstraBill Logo" class="h-full w-full object-cover rounded-full z-10 shadow-[0_0_20px_rgba(99,102,241,0.7)] border border-primary/50" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%236366f1\'%3E%3Cpath d=\'M13 2L3 14h9l-1 8 10-12h-9l1-8z\'/%3E%3C/svg%3E';">
                <div class="absolute inset-0 bg-primary/40 blur-xl rounded-full animate-pulse-glow"></div>
            </div>
            <h1 class="text-2xl font-display font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white via-slate-200 to-slate-400">AstraBill</h1>
        </div>
        <div class="flex items-center gap-2">
            <span class="relative flex h-2.5 w-2.5">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-secondary opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-secondary"></span>
            </span>
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-300 hidden sm:inline-block">Live Predictor</span>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Inputs & Controls -->
            <div class="lg:col-span-7 flex flex-col gap-6 opacity-0 animate-slide-up stagger-1">
                
                <!-- Tabs -->
                <div class="glass-panel rounded-2xl p-2 flex overflow-x-auto hide-scrollbar gap-2 relative z-10">
                    <button onclick="switchTab('meter')" id="tab-meter" class="flex-1 py-3.5 px-4 text-sm font-semibold rounded-xl transition-all duration-300 tab-active flex items-center justify-center gap-2 hover:bg-white/5">
                        <i class="fa-solid fa-gauge-high"></i> Meter Reading
                    </button>
                    <button onclick="switchTab('appliance')" id="tab-appliance" class="flex-1 py-3.5 px-4 text-sm font-medium rounded-xl transition-all duration-300 text-slate-400 hover:text-white hover:bg-white/5 border border-transparent flex items-center justify-center gap-2">
                        <i class="fa-solid fa-microchip"></i> Smart Devices
                    </button>
                    <button onclick="switchTab('tariff')" id="tab-tariff" class="flex-1 py-3.5 px-4 text-sm font-medium rounded-xl transition-all duration-300 text-slate-400 hover:text-white hover:bg-white/5 border border-transparent flex items-center justify-center gap-2">
                        <i class="fa-solid fa-sliders"></i> Tariff Settings
                    </button>
                </div>

                <!-- Tab Content: Meter Reading -->
                <div id="content-meter" class="glass-panel rounded-3xl p-8 transition-all duration-500">
                    <h2 class="text-xl font-display font-semibold mb-2 flex items-center gap-3">
                        <div class="p-2 bg-primary/10 rounded-lg text-primary"><i class="fa-solid fa-calculator"></i></div> Quick Calculator
                    </h2>
                    <p class="text-sm text-slate-400 mb-8">Enter your previous and current electricity meter readings to accurately calculate your estimated bill.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 group-focus-within:text-primary transition-colors">Previous Reading (kWh)</label>
                            <div class="relative">
                                <i class="fa-solid fa-bolt absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-primary transition-colors"></i>
                                <input type="number" id="prev-reading" placeholder="e.g., 14500" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-10 pr-4 py-4 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all shadow-inner" oninput="calculateFromMeter()">
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 group-focus-within:text-primary transition-colors">Current Reading (kWh)</label>
                            <div class="relative">
                                <i class="fa-solid fa-bolt absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-primary transition-colors"></i>
                                <input type="number" id="curr-reading" placeholder="e.g., 14850" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-10 pr-4 py-4 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all shadow-inner" oninput="calculateFromMeter()">
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 p-6 bg-gradient-to-r from-slate-800/30 to-slate-900/50 rounded-2xl border border-white/5 flex items-center justify-between group hover:border-white/10 transition-colors">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400">Total Units Consumed</p>
                            <p class="text-4xl font-display font-bold text-white mt-2 flex items-baseline gap-1">
                                <span id="meter-units-display">0.0</span> 
                                <span class="text-base text-slate-500 font-medium tracking-wide">kWh</span>
                            </p>
                        </div>
                        <div class="h-16 w-16 rounded-2xl bg-primary/10 flex items-center justify-center border border-primary/20 shadow-[0_0_20px_rgba(99,102,241,0.15)] group-hover:scale-105 transition-transform duration-500">
                            <i class="fa-solid fa-bolt-lightning text-primary text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Smart Appliances -->
                <div id="content-appliance" class="glass-panel rounded-3xl p-8 hidden transition-all duration-500 opacity-0 translate-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-display font-semibold flex items-center gap-3">
                            <div class="p-2 bg-secondary/10 rounded-lg text-secondary"><i class="fa-solid fa-microchip"></i></div> Device Predictor
                        </h2>
                        <button onclick="openAddApplianceModal()" class="bg-gradient-to-r from-primary to-primaryHover text-white px-5 py-2.5 rounded-xl text-sm font-medium transition-all duration-300 flex items-center gap-2 shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-0.5">
                            <i class="fa-solid fa-plus"></i> Add Device
                        </button>
                    </div>
                    <p class="text-sm text-slate-400 mb-8">Build your household profile to estimate future consumption based on daily usage patterns.</p>

                    <!-- Appliance List -->
                    <div class="space-y-4 max-h-[400px] overflow-y-auto pr-2 hide-scrollbar" id="appliance-list">
                        <!-- Dynamic content populated by JS -->
                    </div>

                    <div class="mt-6 p-6 bg-gradient-to-r from-slate-800/30 to-slate-900/50 rounded-2xl border border-white/5 flex items-center justify-between">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-wider text-slate-400">Estimated Monthly Load</p>
                            <p class="text-3xl font-display font-bold text-white mt-2 flex items-baseline gap-1">
                                <span id="appliance-units-display">0.0</span> 
                                <span class="text-base text-slate-500 font-medium tracking-wide">kWh</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Tariff Settings -->
                <div id="content-tariff" class="glass-panel rounded-3xl p-8 hidden transition-all duration-500 opacity-0 translate-y-4">
                    <h2 class="text-xl font-display font-semibold mb-2 flex items-center gap-3">
                        <div class="p-2 bg-amber-500/10 rounded-lg text-amber-500"><i class="fa-solid fa-sliders"></i></div> Tariff Configuration
                    </h2>
                    <p class="text-sm text-slate-400 mb-8">Configure exact billing parameters and pricing slabs corresponding to your local provider.</p>

                    <div class="space-y-8">
                        <!-- Slabs -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <label class="block text-xs font-semibold uppercase tracking-wider text-slate-300">Pricing Slabs (₹/kWh)</label>
                                <button onclick="addSlab()" class="text-sm font-semibold text-primary hover:text-primaryHover transition-colors flex items-center gap-1"><i class="fa-solid fa-circle-plus"></i> Add Slab</button>
                            </div>
                            <div id="slabs-container" class="space-y-3">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <hr class="border-white/5">

                        <!-- Fixed Charges & Tax -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="group">
                                <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 group-focus-within:text-primary transition-colors">Monthly Fixed Charge (₹)</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-medium">₹</span>
                                    <input type="number" id="fixed-charge" value="150" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-8 pr-4 py-4 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all shadow-inner" oninput="saveTariffSettings()">
                                </div>
                            </div>
                            <div class="group">
                                <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 group-focus-within:text-primary transition-colors">Electricity Duty / Tax (%)</label>
                                <div class="relative">
                                    <i class="fa-solid fa-percent absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm"></i>
                                    <input type="number" id="tax-rate" value="5" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-10 pr-4 py-4 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all shadow-inner" oninput="saveTariffSettings()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Results & Analytics -->
            <div class="lg:col-span-5 flex flex-col gap-6 opacity-0 animate-slide-up stagger-2">
                
                <!-- Bill Summary Card -->
                <div class="glass-panel rounded-3xl p-8 relative overflow-hidden group hover:shadow-[0_8px_40px_rgba(99,102,241,0.12)] transition-all duration-500 border-t border-white/10">
                    <!-- Background aesthetic blur -->
                    <div class="absolute -top-32 -right-32 w-80 h-80 rounded-full bg-primary/20 blur-[80px] group-hover:bg-primary/30 transition-colors duration-700 pointer-events-none"></div>
                    <div class="absolute -bottom-32 -left-32 w-80 h-80 rounded-full bg-secondary/10 blur-[80px] group-hover:bg-secondary/20 transition-colors duration-700 pointer-events-none"></div>
                    
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-6">
                            <h3 class="text-xs font-bold text-slate-300 uppercase tracking-widest flex items-center gap-2">
                                <i class="fa-solid fa-file-invoice text-primary"></i> Estimated Bill
                            </h3>
                            <span class="px-3 py-1 bg-white/5 border border-white/10 rounded-full text-[10px] font-semibold tracking-widest text-slate-300">THIS MONTH</span>
                        </div>
                        
                        <div class="flex items-baseline gap-2 mb-8 border-b border-white/5 pb-8">
                            <span class="text-3xl font-semibold text-slate-400">₹</span>
                            <span class="text-6xl md:text-7xl font-display font-bold text-transparent bg-clip-text bg-gradient-to-br from-white via-slate-100 to-slate-400 tracking-tight" id="total-bill">0.00</span>
                        </div>

                        <div class="space-y-3 text-sm font-medium">
                            <div class="flex justify-between items-center p-3 rounded-xl hover:bg-white/5 transition-colors">
                                <span class="text-slate-400 flex items-center gap-3"><div class="w-2.5 h-2.5 rounded-full bg-primary shadow-[0_0_8px_rgba(99,102,241,0.8)]"></div> Energy Charges (<span id="summary-units">0</span> kWh)</span>
                                <span class="text-white text-base tracking-wide" id="summary-energy-charge">₹0.00</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-xl hover:bg-white/5 transition-colors">
                                <span class="text-slate-400 flex items-center gap-3"><div class="w-2.5 h-2.5 rounded-full bg-purple-500 shadow-[0_0_8px_rgba(168,85,247,0.8)]"></div> Fixed Charges</span>
                                <span class="text-white text-base tracking-wide" id="summary-fixed-charge">₹0.00</span>
                            </div>
                            <div class="flex justify-between items-center p-3 rounded-xl hover:bg-white/5 transition-colors">
                                <span class="text-slate-400 flex items-center gap-3"><div class="w-2.5 h-2.5 rounded-full bg-secondary shadow-[0_0_8px_rgba(20,184,166,0.8)]"></div> Taxes & Duty (<span id="summary-tax-percent">0</span>%)</span>
                                <span class="text-white text-base tracking-wide" id="summary-tax-amount">₹0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart: Cost Breakdown -->
                <div class="glass-panel rounded-3xl p-6 hover:border-white/10 transition-colors duration-300">
                    <h3 class="text-xs font-bold text-slate-300 uppercase tracking-widest mb-6 flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie text-slate-400"></i> Cost Breakdown
                    </h3>
                    <div class="h-56 relative flex justify-center">
                        <canvas id="costBreakdownChart"></canvas>
                    </div>
                </div>

                <!-- Chart: Appliance Usage (Only visible in appliance mode) -->
                <div id="appliance-chart-container" class="glass-panel rounded-3xl p-6 hidden hover:border-white/10 transition-colors duration-300">
                    <h3 class="text-xs font-bold text-slate-300 uppercase tracking-widest mb-6 flex items-center gap-2">
                        <i class="fa-solid fa-chart-column text-slate-400"></i> Consumption by Device
                    </h3>
                    <div class="h-56 relative">
                        <canvas id="applianceUsageChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- Modal: Add Appliance -->
    <div id="add-appliance-modal" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-md hidden items-center justify-center p-4 transition-opacity duration-300 opacity-0">
        <div class="glass-panel bg-slate-900/90 rounded-3xl p-8 w-full max-w-md border border-white/10 relative shadow-2xl transform scale-95 transition-all duration-300 translate-y-4" id="modal-content">
            <button onclick="closeAddApplianceModal()" class="absolute top-6 right-6 w-8 h-8 flex items-center justify-center rounded-full bg-white/5 text-slate-400 hover:text-white hover:bg-white/10 transition-all">
                <i class="fa-solid fa-xmark"></i>
            </button>
            
            <h3 class="text-2xl font-display font-bold text-white mb-6">Add Device</h3>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-3">Quick Presets</label>
                    <div class="grid grid-cols-4 gap-3 mb-5">
                        <button type="button" onclick="selectPreset('ac')" class="preset-btn p-3 rounded-2xl bg-slate-800/50 border border-white/5 hover:border-primary hover:bg-primary/5 flex flex-col items-center gap-2 transition-all duration-300 hover:-translate-y-1">
                            <i class="fa-solid fa-snowflake text-primary text-xl"></i>
                            <span class="text-[10px] font-semibold text-slate-300 uppercase tracking-wider">AC</span>
                        </button>
                        <button type="button" onclick="selectPreset('fridge')" class="preset-btn p-3 rounded-2xl bg-slate-800/50 border border-white/5 hover:border-primary hover:bg-primary/5 flex flex-col items-center gap-2 transition-all duration-300 hover:-translate-y-1">
                            <i class="fa-solid fa-icicles text-blue-400 text-xl"></i>
                            <span class="text-[10px] font-semibold text-slate-300 uppercase tracking-wider">Fridge</span>
                        </button>
                        <button type="button" onclick="selectPreset('tv')" class="preset-btn p-3 rounded-2xl bg-slate-800/50 border border-white/5 hover:border-primary hover:bg-primary/5 flex flex-col items-center gap-2 transition-all duration-300 hover:-translate-y-1">
                            <i class="fa-solid fa-tv text-purple-400 text-xl"></i>
                            <span class="text-[10px] font-semibold text-slate-300 uppercase tracking-wider">TV</span>
                        </button>
                        <button type="button" onclick="selectPreset('fan')" class="preset-btn p-3 rounded-2xl bg-slate-800/50 border border-white/5 hover:border-primary hover:bg-primary/5 flex flex-col items-center gap-2 transition-all duration-300 hover:-translate-y-1">
                            <i class="fa-solid fa-fan text-slate-300 text-xl"></i>
                            <span class="text-[10px] font-semibold text-slate-300 uppercase tracking-wider">Fan</span>
                        </button>
                    </div>
                    
                    <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">Device Name</label>
                    <input type="text" id="new-app-name" placeholder="e.g., Gaming PC" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl px-4 py-3.5 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all">
                </div>
                
                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">Power (Watts)</label>
                        <input type="number" id="new-app-power" placeholder="1500" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl px-4 py-3.5 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2">Quantity</label>
                        <input type="number" id="new-app-qty" value="1" min="1" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-xl px-4 py-3.5 text-white font-medium focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary focus:bg-slate-900 transition-all">
                    </div>
                </div>

                <div class="pt-2">
                    <label class="flex justify-between items-center text-xs font-semibold uppercase tracking-wider text-slate-400 mb-4">
                        <span>Daily Usage</span>
                        <span class="text-primary bg-primary/10 px-3 py-1 rounded-full"><span id="modal-hours-display" class="font-bold text-sm">8</span> Hours</span>
                    </label>
                    <input type="range" id="new-app-hours" min="0" max="24" step="0.5" value="8" oninput="document.getElementById('modal-hours-display').innerText = this.value">
                </div>

                <button onclick="addAppliance()" class="w-full bg-gradient-to-r from-primary to-primaryHover hover:from-primaryHover hover:to-indigo-700 text-white font-semibold py-4 rounded-xl transition-all duration-300 mt-6 shadow-lg shadow-primary/25 hover:shadow-primary/40 transform hover:-translate-y-0.5 flex justify-center items-center gap-2">
                    <i class="fa-solid fa-check"></i> Save Device
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        let currentMode = 'meter';
        let totalUnits = 0;
        let billDetails = { energyCharge: 0, fixedCharge: 0, taxAmount: 0, total: 0 };
        let previousBillDetails = { energyCharge: 0, fixedCharge: 0, taxAmount: 0, total: 0 };
        let previousTotalUnits = 0;
        
        let costChartInstance = null;
        let usageChartInstance = null;

        // Default Tariff Slabs
        let tariffSlabs = [
            { id: 1, limit: 100, rate: 3.50 },
            { id: 2, limit: 200, rate: 5.00 },
            { id: 3, limit: 500, rate: 7.50 },
            { id: 4, limit: 999999, rate: 10.00 }
        ];
        let fixedCharge = 150;
        let taxRate = 5;

        // Appliance Data
        let appliances = [
            { id: 1, name: 'Air Conditioner', power: 1500, qty: 1, hours: 8, icon: 'fa-snowflake', color: '#6366f1' },
            { id: 2, name: 'Refrigerator', power: 250, qty: 1, hours: 24, icon: 'fa-icicles', color: '#14b8a6' },
            { id: 3, name: 'Ceiling Fan', power: 75, qty: 3, hours: 12, icon: 'fa-fan', color: '#94a3b8' },
            { id: 4, name: 'LED TV', power: 100, qty: 1, hours: 5, icon: 'fa-tv', color: '#a855f7' }
        ];

        const presetAppliances = {
            'ac': { name: 'Air Conditioner', power: 1500, icon: 'fa-snowflake', color: '#6366f1' },
            'fridge': { name: 'Refrigerator', power: 250, icon: 'fa-icicles', color: '#14b8a6' },
            'tv': { name: 'Television', power: 100, icon: 'fa-tv', color: '#a855f7' },
            'fan': { name: 'Ceiling Fan', power: 75, icon: 'fa-fan', color: '#94a3b8' },
            'washing_machine': { name: 'Washing Machine', power: 500, icon: 'fa-shirt', color: '#10b981' },
            'heater': { name: 'Water Heater', power: 2000, icon: 'fa-fire', color: '#ef4444' },
            'bulb': { name: 'LED Bulb', power: 15, icon: 'fa-lightbulb', color: '#eab308' }
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTariffSettings();
            renderApplianceList();
            initCharts();
            calculateFromMeter(); 
        });

        // --- Smooth Number Animation ---
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if(!obj) return;
            
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                // easeOutQuart
                const ease = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * ease;
                
                if(id === 'total-bill') obj.innerText = current.toFixed(2);
                else if(id === 'summary-units' || id.includes('units-display')) obj.innerText = current.toFixed(1);
                else obj.innerText = '₹' + current.toFixed(2);
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                } else {
                    if(id === 'total-bill') obj.innerText = end.toFixed(2);
                    else if(id === 'summary-units' || id.includes('units-display')) obj.innerText = end.toFixed(1);
                    else obj.innerText = '₹' + end.toFixed(2);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- UI Navigation ---
        function switchTab(tabId) {
            currentMode = tabId === 'tariff' ? currentMode : tabId; 
            
            // Reset tabs
            ['meter', 'appliance', 'tariff'].forEach(id => {
                const btn = document.getElementById(`tab-${id}`);
                btn.classList.remove('tab-active');
                btn.classList.add('text-slate-400', 'border-transparent');
                
                const content = document.getElementById(`content-${id}`);
                content.classList.add('hidden', 'opacity-0', 'translate-y-4');
                content.classList.remove('opacity-100', 'translate-y-0');
            });

            // Activate target
            const targetBtn = document.getElementById(`tab-${tabId}`);
            targetBtn.classList.add('tab-active');
            targetBtn.classList.remove('text-slate-400', 'border-transparent');
            
            const targetContent = document.getElementById(`content-${tabId}`);
            targetContent.classList.remove('hidden');
            
            // Allow block display to compute before sliding in
            setTimeout(() => {
                targetContent.classList.remove('opacity-0', 'translate-y-4');
                targetContent.classList.add('opacity-100', 'translate-y-0');
            }, 20);

            if (tabId === 'appliance') {
                document.getElementById('appliance-chart-container').classList.remove('hidden');
                calculateFromAppliances();
            } else if (tabId === 'meter') {
                document.getElementById('appliance-chart-container').classList.add('hidden');
                calculateFromMeter();
            } else if (tabId === 'tariff') {
                if(currentMode === 'meter') calculateFromMeter();
                else calculateFromAppliances();
            }
        }

        // --- Core Calculation Logic ---
        function calculateBill(units) {
            let remainingUnits = units;
            let energyCharge = 0;
            let previousLimit = 0;

            let sortedSlabs = [...tariffSlabs].sort((a, b) => a.limit - b.limit);

            for (let i = 0; i < sortedSlabs.length; i++) {
                let slab = sortedSlabs[i];
                let slabSize = slab.limit - previousLimit;
                
                if (remainingUnits > slabSize) {
                    energyCharge += slabSize * slab.rate;
                    remainingUnits -= slabSize;
                } else {
                    energyCharge += remainingUnits * slab.rate;
                    break;
                }
                previousLimit = slab.limit;
            }

            let tax = (energyCharge + fixedCharge) * (taxRate / 100);
            let total = energyCharge + fixedCharge + tax;

            return { energyCharge, fixedCharge, taxAmount: tax, total };
        }

        function updateSummaryUI() {
            // Animate Summary Card
            animateValue('total-bill', previousBillDetails.total, billDetails.total, 1000);
            animateValue('summary-energy-charge', previousBillDetails.energyCharge, billDetails.energyCharge, 800);
            animateValue('summary-fixed-charge', previousBillDetails.fixedCharge, billDetails.fixedCharge, 800);
            animateValue('summary-tax-amount', previousBillDetails.taxAmount, billDetails.taxAmount, 800);
            animateValue('summary-units', previousTotalUnits, totalUnits, 800);
            
            document.getElementById('summary-tax-percent').innerText = taxRate;

            // Animate Tab specific unit displays
            if(currentMode === 'meter') {
                animateValue('meter-units-display', previousTotalUnits, totalUnits, 800);
            } else {
                animateValue('appliance-units-display', previousTotalUnits, totalUnits, 800);
            }
            
            previousBillDetails = { ...billDetails };
            previousTotalUnits = totalUnits;
            
            updateCharts();
        }

        function calculateFromMeter() {
            if(currentMode !== 'meter') return;
            let prev = parseFloat(document.getElementById('prev-reading').value) || 0;
            let curr = parseFloat(document.getElementById('curr-reading').value) || 0;
            totalUnits = Math.max(0, curr - prev);
            billDetails = calculateBill(totalUnits);
            updateSummaryUI();
        }

        function calculateFromAppliances() {
            if(currentMode !== 'appliance') return;
            let monthlyUnits = 0;
            appliances.forEach(app => {
                let dailyKwh = (app.power * app.hours * app.qty) / 1000;
                let monthly = dailyKwh * 30;
                app.monthlyConsumption = monthly; 
                monthlyUnits += monthly;
            });

            totalUnits = monthlyUnits;
            billDetails = calculateBill(totalUnits);
            updateSummaryUI();
        }

        // --- Appliances List Render ---
        function renderApplianceList() {
            const container = document.getElementById('appliance-list');
            container.innerHTML = '';
            
            if(appliances.length === 0) {
                container.innerHTML = `<div class="text-center py-10 bg-slate-800/20 rounded-2xl border border-dashed border-white/10 text-slate-500 text-sm">No devices added. Add devices to predict bill.</div>`;
                return;
            }

            appliances.forEach(app => {
                let monthlyKwh = ((app.power * app.hours * app.qty) / 1000) * 30;
                container.innerHTML += `
                    <div class="bg-slate-800/40 border border-white/5 p-4 rounded-2xl flex items-center gap-4 group hover:border-white/10 hover:bg-slate-800/60 transition-all duration-300 hover:-translate-y-1">
                        <div class="h-12 w-12 rounded-xl bg-slate-900/80 flex items-center justify-center shrink-0 border border-white/5 shadow-inner">
                            <i class="fa-solid ${app.icon} text-lg" style="color: ${app.color}"></i>
                        </div>
                        <div class="flex-grow min-w-0">
                            <div class="flex justify-between items-start mb-1.5">
                                <h4 class="text-sm font-semibold text-white truncate pr-2">${app.name}</h4>
                                <button onclick="removeAppliance(${app.id})" class="text-slate-500 hover:text-red-400 transition-colors shrink-0">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </div>
                            <div class="text-[11px] font-medium text-slate-400 flex flex-wrap gap-x-3 gap-y-1 uppercase tracking-wider">
                                <span><i class="fa-solid fa-bolt mr-1 text-slate-500"></i>${app.power}W × ${app.qty}</span>
                                <span><i class="fa-regular fa-clock mr-1 text-slate-500"></i>${app.hours}h/day</span>
                                <span class="text-primary ml-auto">${monthlyKwh.toFixed(1)} kWh/mo</span>
                            </div>
                            <!-- Inline slider -->
                            <div class="mt-3 flex items-center gap-3">
                                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Usage</span>
                                <input type="range" min="0" max="24" step="0.5" value="${app.hours}" 
                                    onchange="updateApplianceHours(${app.id}, this.value)"
                                    oninput="this.nextElementSibling.innerText = this.value + 'h'"
                                    class="flex-grow h-1 bg-slate-700/50 rounded-full appearance-none">
                                <span class="text-xs text-slate-300 w-8 text-right font-medium">${app.hours}h</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function updateApplianceHours(id, newHours) {
            const app = appliances.find(a => a.id === id);
            if(app) {
                app.hours = parseFloat(newHours);
                calculateFromAppliances();
                renderApplianceList();
            }
        }

        function removeAppliance(id) {
            appliances = appliances.filter(a => a.id !== id);
            renderApplianceList();
            calculateFromAppliances();
        }

        // --- Modal Logic ---
        function openAddApplianceModal() {
            const modal = document.getElementById('add-appliance-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.classList.add('opacity-100');
                content.classList.remove('scale-95', 'translate-y-4');
                content.classList.add('scale-100', 'translate-y-0');
            }, 10);
            
            // Clear inputs safely
            document.getElementById('new-app-name').value = '';
            document.getElementById('new-app-power').value = '';
            document.getElementById('new-app-qty').value = '1';
            document.getElementById('new-app-hours').value = '8';
            document.getElementById('modal-hours-display').innerText = '8';
        }

        function closeAddApplianceModal() {
            const modal = document.getElementById('add-appliance-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('opacity-100');
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100', 'translate-y-0');
            content.classList.add('scale-95', 'translate-y-4');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        let selectedPresetColor = '#cbd5e1';
        let selectedPresetIcon = 'fa-plug';

        function selectPreset(type) {
            const preset = presetAppliances[type];
            document.getElementById('new-app-name').value = preset.name;
            document.getElementById('new-app-power').value = preset.power;
            selectedPresetIcon = preset.icon;
            selectedPresetColor = preset.color;
            
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary/5');
            });
            event.currentTarget.classList.add('border-primary', 'bg-primary/5');
        }

        function addAppliance() {
            const name = document.getElementById('new-app-name').value || 'Custom Device';
            const power = parseFloat(document.getElementById('new-app-power').value);
            const qty = parseInt(document.getElementById('new-app-qty').value) || 1;
            const hours = parseFloat(document.getElementById('new-app-hours').value) || 0;

            if(!power || power <= 0) {
                // simple visual shake instead of blocky alert
                const modal = document.getElementById('modal-content');
                modal.style.transform = "translateX(-10px)";
                setTimeout(()=> modal.style.transform = "translateX(10px)", 50);
                setTimeout(()=> modal.style.transform = "scale(100%) translateY(0)", 100);
                return;
            }

            appliances.push({
                id: Date.now(),
                name, power, qty, hours,
                icon: selectedPresetIcon,
                color: selectedPresetColor
            });

            selectedPresetIcon = 'fa-plug';
            selectedPresetColor = '#cbd5e1';

            closeAddApplianceModal();
            renderApplianceList();
            calculateFromAppliances();
        }

        // --- Tariff Settings ---
        function renderTariffSettings() {
            const container = document.getElementById('slabs-container');
            container.innerHTML = '';
            
            document.getElementById('fixed-charge').value = fixedCharge;
            document.getElementById('tax-rate').value = taxRate;

            tariffSlabs.forEach((slab, index) => {
                let prevLimit = index === 0 ? 0 : tariffSlabs[index-1].limit;
                let rangeText = slab.limit > 900000 ? `> ${prevLimit} units` : `${prevLimit+1} - ${slab.limit} units`;
                if(index === 0) rangeText = `0 - ${slab.limit} units`;

                container.innerHTML += `
                    <div class="flex items-center gap-4 bg-slate-800/30 p-4 rounded-xl border border-white/5 hover:border-white/10 transition-colors">
                        <div class="flex-grow">
                            <div class="text-[10px] font-bold uppercase tracking-wider text-slate-400 mb-1.5">${rangeText}</div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-semibold text-slate-400">Up to</span>
                                <input type="number" value="${slab.limit > 900000 ? '' : slab.limit}" ${slab.limit > 900000 ? 'disabled placeholder="∞"' : ''} 
                                    class="w-20 bg-slate-900 border border-slate-700 rounded-lg px-2 py-1.5 text-white text-sm font-medium focus:outline-none focus:border-primary transition-colors text-center"
                                    onchange="updateSlab(${slab.id}, 'limit', this.value)">
                                <span class="text-xs font-semibold text-slate-400">kWh</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50">
                            <span class="text-sm font-bold text-slate-400 pl-1">₹</span>
                            <input type="number" step="0.1" value="${slab.rate}" 
                                class="w-16 bg-transparent text-white text-sm font-bold focus:outline-none focus:text-primary transition-colors"
                                onchange="updateSlab(${slab.id}, 'rate', this.value)">
                        </div>
                        ${index > 0 && slab.limit <= 900000 ? `
                        <button onclick="removeSlab(${slab.id})" class="text-slate-500 hover:text-red-400 p-2 transition-colors">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        ` : '<div class="w-8"></div>'}
                    </div>
                `;
            });
        }

        function updateSlab(id, field, value) {
            const slab = tariffSlabs.find(s => s.id === id);
            if(slab) {
                if(field === 'limit') slab.limit = value === '' ? 999999 : parseFloat(value);
                else slab.rate = parseFloat(value);
                
                tariffSlabs.sort((a,b) => a.limit - b.limit);
                saveTariffSettings();
                renderTariffSettings(); 
            }
        }

        function removeSlab(id) {
            tariffSlabs = tariffSlabs.filter(s => s.id !== id);
            saveTariffSettings();
            renderTariffSettings();
        }

        function addSlab() {
            const highestCurrentLimit = tariffSlabs.filter(s => s.limit <= 900000).reduce((max, s) => s.limit > max ? s.limit : max, 0);
            tariffSlabs.push({ id: Date.now(), limit: highestCurrentLimit + 100, rate: 5.0 });
            tariffSlabs.sort((a,b) => a.limit - b.limit);
            saveTariffSettings();
            renderTariffSettings();
        }

        function saveTariffSettings() {
            fixedCharge = parseFloat(document.getElementById('fixed-charge').value) || 0;
            taxRate = parseFloat(document.getElementById('tax-rate').value) || 0;
            if(currentMode === 'meter') calculateFromMeter();
            else calculateFromAppliances();
        }

        // --- Charts (Chart.js) ---
        function initCharts() {
            Chart.defaults.color = '#64748b'; // slate-500
            Chart.defaults.font.family = "'Plus Jakarta Sans', sans-serif";
            
            const costCtx = document.getElementById('costBreakdownChart').getContext('2d');
            costChartInstance = new Chart(costCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Energy Charge', 'Fixed Charge', 'Taxes & Duty'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#6366f1', '#a855f7', '#14b8a6'],
                        borderWidth: 0,
                        hoverOffset: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { position: 'right', labels: { usePointStyle: true, padding: 20, font: {weight: '500'} } },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleFont: { family: "'Plus Jakarta Sans', sans-serif" },
                            bodyFont: { family: "'Outfit', sans-serif", size: 14, weight: 'bold' },
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: { label: function(c) { return ' ₹' + c.raw.toFixed(2); } }
                        }
                    }
                }
            });

            const usageCtx = document.getElementById('applianceUsageChart').getContext('2d');
            usageChartInstance = new Chart(usageCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Consumption',
                        data: [],
                        backgroundColor: '#6366f1',
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.03)' }, border: {display: false} },
                        x: { grid: { display: false }, border: {display: false} }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleFont: { family: "'Plus Jakarta Sans', sans-serif" },
                            bodyFont: { family: "'Outfit', sans-serif", size: 14, weight: 'bold' },
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: { label: function(c) { return c.raw.toFixed(1) + ' kWh'; } }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if(!costChartInstance) return;

            // Update Cost Chart
            costChartInstance.data.datasets[0].data = [
                billDetails.energyCharge, 
                billDetails.fixedCharge, 
                billDetails.taxAmount
            ];
            costChartInstance.update();

            // Update Appliance Chart 
            if(currentMode === 'appliance' && usageChartInstance) {
                let sortedApps = [...appliances].sort((a,b) => b.monthlyConsumption - a.monthlyConsumption);
                usageChartInstance.data.labels = sortedApps.map(a => a.name.split(' ')[0]); 
                usageChartInstance.data.datasets[0].data = sortedApps.map(a => a.monthlyConsumption);
                usageChartInstance.data.datasets[0].backgroundColor = sortedApps.map(a => a.color || '#6366f1');
                usageChartInstance.update();
            }
        }
    </script>
</body>
</html>
